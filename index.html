<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Padr√£o Interpreter ‚Äî Demonstra√ß√£o</title>
    <style>
        :root{--bg:#f6f8fa;--surface:#ffffff;--muted:#6a737d;--border:#e1e4e8;--accent:#0366d6;--success:#28a745;--warning:#ffc107;--danger:#d73a49;--shadow:0 1px 2px rgba(27,31,35,.04),0 8px 24px rgba(27,31,35,.08)}
        html,body{height:100%}
        body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#24292e;-webkit-font-smoothing:antialiased}
        .container{max-width:1100px;margin:24px auto;padding:0 20px}
        h1{font-size:1.6rem;margin:0 0 14px;color:#0b2d4a}
        h2{font-size:1.05rem;margin:0 0 12px}
        p{margin:0 0 12px;font-size:0.95rem;line-height:1.6}
        .card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;margin-bottom:20px;box-shadow:var(--shadow)}
        .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
        input[type=text]{flex:1;padding:8px;border:1px solid var(--border);border-radius:6px}
        button{padding:8px 12px;border:1px solid var(--border);border-radius:6px;background:var(--surface);cursor:pointer;font-weight:700}
        button.primary{background:var(--accent);color:#fff;border-color:transparent}
        .row{display:grid;grid-template-columns:1fr 420px;gap:18px}
        .muted{color:var(--muted)}
        .code{background:#f6f8fa;border-left:3px solid var(--border);padding:10px;border-radius:6px;font-family:monospace;font-size:0.85rem;white-space:pre-wrap}
        .result{background:linear-gradient(180deg,#f0f9ff,#e6f4ff);border:2px solid var(--accent);padding:12px;border-radius:6px;text-align:center}
        .metrics{display:flex;gap:12px;margin-top:12px}
        .metric{flex:1;background:#fff;border:1px solid var(--border);padding:10px;border-radius:6px;text-align:center}
        .metric .v{font-weight:800;color:var(--accent);font-size:1.2rem}
        .examples{display:flex;gap:8px;flex-wrap:wrap}
        .chip{padding:6px 10px;background:#f6f8fa;border-radius:999px;border:1px solid var(--border);cursor:pointer}
        .explain{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:12px}
        @media(max-width:980px){.row{grid-template-columns:1fr}.explain{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üîç Padr√£o Interpreter ‚Äî Vis√£o e Demonstra√ß√£o</h1>
            <p class="muted">Esta p√°gina mostra como o padr√£o Interpreter interpreta express√µes (num√©ricas e itens de card√°pio) e por que ele √© √∫til no contexto do seu sistema de pedidos.</p>
            <div class="metrics">
                <div class="metric"><div class="v">Encapsula</div><div class="muted">Express√µes como objetos</div></div>
                <div class="metric"><div class="v">Reutiliz√°vel</div><div class="muted">F√°cil extens√£o de gram√°ticas</div></div>
                <div class="metric"><div class="v">Test√°vel</div><div class="muted">Testes unit√°rios claros</div></div>
            </div>
        </div>

        <div class="card row">
            <div>
                <h2>üßÆ Interpretador ‚Äî Experimente</h2>
                <p class="muted">Digite uma express√£o com n√∫meros, itens do card√°pio (ESPRESSO, LATTE, SANDUICHE, etc.), operadores + - * / e par√™nteses. Aceita sinais juntos ou separados por espa√ßos.</p>

                <div class="controls">
                    <input id="expr" type="text" placeholder="Ex.: 2*ESPRESSO + 1*SANDUICHE ou (10 / 2) * 3 + 1 - 4"/>
                    <button class="primary" onclick="interpretar()">Interpretar</button>
                    <button onclick="limpar()">Limpar</button>
                </div>

                <div style="margin-top:12px" class="examples">
                    <div class="chip" onclick="setExpr('ESPRESSO + LATTE')">ESPRESSO + LATTE</div>
                    <div class="chip" onclick="setExpr('2*ESPRESSO + 1*SANDUICHE')">2*ESPRESSO + 1*SANDUICHE</div>
                    <div class="chip" onclick="setExpr('10 / 2 * 3 + 1 - 4')">10 / 2 * 3 + 1 - 4</div>
                    <div class="chip" onclick="setExpr('6 / 0')">6 / 0 (erro)</div>
                    <div class="chip" onclick="setExpr('2 ^ 2')">2 ^ 2 (invalido)</div>
                </div>

                <div style="margin-top:12px" id="steps" class="code">Passos do parser aparecer√£o aqui...</div>
            </div>

            <div>
                <h2>üìä Resultado</h2>
                <div id="resultBox" class="result">
                    <div id="resultado" style="font-size:1.4rem;font-weight:800">‚Äî</div>
                    <div id="mensagem" class="muted">Interpretador aguardando entrada</div>
                </div>

                <div style="margin-top:12px">
                    <h3>Observa√ß√£o r√°pida</h3>
                    <p class="muted">O Interpreter permite isolar a gram√°tica e a avalia√ß√£o ‚Äî √∫til para calcular pedidos, aplicar promo√ß√µes e validar f√≥rmulas sem poluir l√≥gica de neg√≥cio.</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>‚úÖ Vantagens do Interpreter no seu sistema</h2>
            <div class="explain">
                <div>
                    <h3>Quando usar</h3>
                    <ul>
                        <li>Quando precisa avaliar express√µes definidas por usu√°rios (regras, descontos).</li>
                        <li>Quando gram√°tica cresce ‚Äî separa parsing da execu√ß√£o.</li>
                        <li>Testes ficam mais simples: cada n√≥ da √°rvore √© test√°vel.</li>
                    </ul>
                </div>
                <div>
                    <h3>Benef√≠cios pr√°ticos</h3>
                    <ul>
                        <li>Permite caching de √°rvores parseadas para efici√™ncia.</li>
                        <li>Facilita memoiza√ß√£o e otimiza√ß√µes (precompilar express√µes).</li>
                        <li>Diminui bugs por centralizar regras de interpreta√ß√£o.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üßæ Exemplo (implementa√ß√£o em Java)</h2>
            <div class="code">
                // Trechos do projeto existente
                Interface: InterpretadorExpressao { double interpretar(); }

                Classe: InterpretadorExpressoesCafeBar
                - Tokenize
                - Converter para RPN (Shunting-yard)
                - Montar √°rvore de Expressao
                - Avaliar

                Classe: Pedido monta expressao como "2 * ESPRESSO + 1 * SANDUICHE" e usa o interpretador
            </div>
            <p class="muted">Esse isolamento permite trocar a gram√°tica sem alterar `Pedido` ou regras de neg√≥cio.</p>
        </div>

        <div class="card">
            <h2>‚öñÔ∏è Compara√ß√£o: Com vs Sem Interpreter</h2>
            <div class="explain">
                <div>
                    <h3>Sem Interpreter</h3>
                    <div class="code">// L√≥gica misturada
if (token.equals("ESPRESSO")) total += 3.0;
else if (token.equals("LATTE")) total += 4.0; // espalhado por v√°rias partes</div>
                </div>
                <div>
                    <h3>Com Interpreter</h3>
                    <div class="code">// Gram√°tica e avalia√ß√£o centralizadas
Expressao raiz = interpretador.parse(expr);
double total = raiz.interpretar();</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üî¨ Experimenta√ß√£o</h2>
            <p class="muted">Abaixo h√° logs detalhados do parser; mensagens de erro seguem o mesmo padr√£o das exce√ß√µes Java usadas no projeto.</p>
            <div id="log" class="code">Logs aparecer√£o aqui...</div>
        </div>

    </div>

    <script>
        // CARDAPIO (mesmos pre√ßos do interpretador Java)
        const CARDAPIO = {
            'ESPRESSO': 3.0,
            'LATTE': 4.0,
            'CAPPUCCINO': 4.5,
            'SANDUICHE': 2.0,
            'PAO': 1.5,
            'CHA': 2.5,
            'SUCOS': 3.5
        };

        function log(msg){ document.getElementById('log').textContent = msg; }
        function steps(msg){ document.getElementById('steps').textContent = msg; }
        function setExpr(v){ document.getElementById('expr').value = v }
        function limpar(){ document.getElementById('expr').value=''; document.getElementById('resultado').textContent='‚Äî'; document.getElementById('mensagem').textContent='Interpretador aguardando entrada'; steps(''); log(''); }

        // Preprocess: adiciona espa√ßos ao redor de operadores e par√™nteses para facilitar tokeniza√ß√£o
        function normalize(s){ return s.replace(/([()+\-*/])/g,' $1 ').replace(/\s+/g,' ').trim(); }

        function isNumber(tok){ return !isNaN(Number(tok)); }
        function isItem(tok){ return CARDAPIO.hasOwnProperty(tok.toUpperCase()); }
        function isOperator(tok){ return ['+','-','*','/'].includes(tok); }
        function precedence(op){ if(op=='*' || op=='/') return 2; if(op=='+'||op=='-') return 1; return 0; }

        // Converte tokens em RPN (shunting-yard)
        function toRPN(tokens){
            const out = [];
            const ops = [];
            for(const t of tokens){
                if(isNumber(t) || isItem(t)) out.push(t);
                else if(isOperator(t)){
                    while(ops.length && isOperator(ops[ops.length-1]) && precedence(ops[ops.length-1])>=precedence(t)) out.push(ops.pop());
                    ops.push(t);
                } else if(t=='(') ops.push(t);
                else if(t==')'){
                    let found=false; while(ops.length){ const top=ops.pop(); if(top=='('){ found=true; break; } else out.push(top);} if(!found) throw new Error('Express√£o inv√°lida');
                } else throw new Error('Express√£o com elemento inv√°lido');
            }
            while(ops.length){ const top = ops.pop(); if(top=='('||top==')') throw new Error('Express√£o inv√°lida'); out.push(top); }
            return out;
        }

        // Monta √°rvore em forma de n√≥s JS simples e avalia
        function evalRPN(rpn){
            const stack = [];
            for(const token of rpn){
                if(isNumber(token)) stack.push({type:'num',v:Number(token)});
                else if(isItem(token)) stack.push({type:'num',v:CARDAPIO[token.toUpperCase()]});
                else if(isOperator(token)){
                    if(stack.length<2) throw new Error('Express√£o inv√°lida');
                    const b = stack.pop(); const a = stack.pop();
                    let v;
                    switch(token){
                        case '+': v = a.v + b.v; break;
                        case '-': v = a.v - b.v; break;
                        case '*': v = a.v * b.v; break;
                        case '/': v = a.v / b.v; break;
                        default: throw new Error('Express√£o com elemento inv√°lido');
                    }
                    stack.push({type:'num',v:v});
                } else throw new Error('Express√£o com elemento inv√°lido');
            }
            if(stack.length!==1) throw new Error('Express√£o inv√°lida');
            return stack[0].v;
        }

        function interpretar(){
            const raw = document.getElementById('expr').value.trim();
            if(!raw){ document.getElementById('mensagem').textContent='Digite uma express√£o'; return; }
            const norm = normalize(raw);
            const tokens = norm.split(' ');
            steps('Tokens: ' + JSON.stringify(tokens));
            try{
                const rpn = toRPN(tokens);
                steps(steps().toString());
                log('RPN: ' + JSON.stringify(rpn));
                const res = evalRPN(rpn);
                document.getElementById('resultado').textContent = Number.isFinite(res) ? res : 'NaN';
                document.getElementById('mensagem').textContent = 'Interpretado com sucesso';
            } catch(e){
                // Garantir mensagens id√™nticas √†s usadas no Java
                const msg = (e.message && (e.message.includes('inv√°lido') || e.message.includes('Inv√°lido'))) ? e.message : e.message || e.toString();
                if(msg.includes('elemento')) document.getElementById('mensagem').textContent = 'Express√£o com elemento inv√°lido';
                else if(msg.includes('inv√°lida')) document.getElementById('mensagem').textContent = 'Express√£o inv√°lida';
                else document.getElementById('mensagem').textContent = msg;
                document.getElementById('resultado').textContent = '‚Äî';
                log('Erro: ' + e.message);
            }
        }

        // pequena util para steps: getter/setter
        function steps(val){ if(val===undefined) return document.getElementById('steps').textContent; document.getElementById('steps').textContent = val; }

        // inicializa exemplos
        document.addEventListener('DOMContentLoaded', ()=>{ document.getElementById('expr').value = '2 * ESPRESSO + 1 * SANDUICHE'; });
    </script>
</body>
</html>
